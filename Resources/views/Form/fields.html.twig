{%- block idci_step_step_form_row -%}
    {% if display_title %}
        {{- form_label(form) -}}
    {% endif %}
    {{- form_errors(form) -}}
    {{- form_widget(form) -}}
{%- endblock idci_step_step_form_row -%}

{%- block idci_step_step_form_html_row -%}
    {% set display_title = false %}
    {{- block('idci_step_step_form_row') -}}
{%- endblock idci_step_step_form_html_row -%}
{%- block idci_step_step_form_html_widget -%}
    {% spaceless %}
        {{ content | raw }}
    {% endspaceless %}
{%- endblock idci_step_step_form_html_widget -%}

{%- block idci_step_step_form_form_row -%}
    {{- block('idci_step_step_form_row') -}}
{%- endblock idci_step_step_form_form_row -%}

{%- block idci_step_action_form_js_confirm_row -%}
    {{ form_widget(form) }}
{%- endblock -%}
{%- block idci_step_action_form_js_confirm_widget -%}
    <script type="text/javascript">
        var observedItem = document.getElementById("{{ form.vars.observed_id }}");
        observedItem.addEventListener("click", function(event) {
            if (!confirm("{{ form.vars.message }}")) {
                event.preventDefault();
            }
        }, false);
    </script>
{%- endblock -%}

{%- block button_widget -%}
    {%- if label is empty -%}
        {% set label = name|humanize %}
    {%- endif -%}
    <button type="{{ type|default('button') }}" {{ block('button_attributes') }}>{{ label|trans({}, translation_domain) }}</button>
{%- endblock button_widget -%}

{%- block idci_step_action_form_link_row -%}
    <a href="{{ form.vars.href }}" target="{{ form.vars.target }}"{% for attrname, attrvalue in attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}>{{ label|trans({}, translation_domain) }}</a>
{%- endblock idci_step_action_form_link_row -%}

{%- block step_editor_widget -%}{{- form_widget(form) -}}
    <script type="text/javascript">

        window.addEventListener('load', function () {
            loadExtraStepEditors();
        });

        var configuredTypeTags = [
            {% for tag in form.vars.configured_types_tags %}
                {% if loop.last %}
                    '{{ tag }}'
                {% else %}
                    '{{ tag }}',
                {% endif %}
            {% endfor %}
        ];

        var {{ form.vars.id }}_configuration = {
            editorId: '{{ form.vars.id }}',
            show_configured_types: {{ form.vars.show_configured_types ? 'true' : 'false' }},
            allow_configured_types_edition: {{ form.vars.allow_configured_types_edition ? 'true' : 'false' }},
            configured_types_tags: configuredTypeTags,
            api_url: {
                get_extra_path_event_actions: '{{ path('idci_step_apipatheventactionconfiguration_getpatheventactionconfigurations', { '_format': 'json'}) }}',
                get_extra_path_types: '{{ path('idci_step_apipathtypeconfiguration_getpathtypesconfigurations', { '_format': 'json'}) }}',
                get_extra_step_event_actions: '{{ path('idci_step_apistepeventactionconfiguration_getstepeventactionconfigurations', { '_format': 'json'}) }}',
                get_extra_step_types : '{{ path('idci_step_apisteptypeconfiguration_getsteptypesconfigurations', { '_format': 'json'}) }}',
                get_extra_map_type: '{{ path('idci_step_apimapconfiguration_getmapconfiguration', { '_format': 'json'}) }}',
                get_configured_extra_form_types: '{{ path('idci_extraform_api_getconfiguredextraformtypes', { '_format': 'json' }) }}',
                post_configured_extra_form_types: '{{ path('idci_extraform_api_postconfiguredextraformtypes') }}',
                put_configured_extra_form_types: '{{ path('idci_extraform_api_putconfiguredextraformtypes', { 'name': 'XNAME' }) }}',
                delete_configured_extra_form_types: '{{ path('idci_extraform_api_deleteconfiguredextraformtypes', { 'name': 'XNAME' }) }}',
                get_extra_form_type_options: '{{ path('idci_extraform_api_getextraformtypesoptions', { '_format': 'json', 'type': 'XTYPE'}) }}',
                get_extra_form_types: '{{ path('idci_extraform_api_getextraformtypes', { '_format': 'json'}) }}',
                get_extra_form_constraints: '{{ path('idci_extraform_api_getextraformconstraints', { '_format': 'json'}) }}'
            }
        };

        // We must load the scripts and styles only once, even if many widgets are on the page
        if (typeof window.loadExtraStepEditors !== 'function') {
            document.write(
                '<script type="text/javascript" src="{{ asset('bundles/idciextraform/js/editor.min.js') }}"><\/script>' +
                '<script type="text/javascript" src="{{ asset('bundles/idcistep/js/editor.min.js') }}"><\/script>' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idciextraform/css/font-awesome-4.7.0/css/font-awesome.min.css') }}" />' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idciextraform/css/extra-form-editor.min.css') }}" />' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idciextraform/css/codemirror.css') }}" />' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idciextraform/css/codemirror-dialog.css') }}" />' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idcistep/css/joint.css') }}" />' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idcistep/css/joint-custom.css') }}" />' +
                '<link rel="stylesheet" type="text/css" href="{{ asset('bundles/idcistep/css/extra-step-editor.css') }}" />'
            );
        }
    </script>

{%- endblock step_editor_widget -%}
